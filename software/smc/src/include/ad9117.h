#ifndef __AD9117_H__
#define __AD9117_H__

#include <em_device.h>
#include <stdlib.h>
#include "systick.h"
#include "atomic.h"
#include "gpio.h"
#include "usart.h"

// Registers
#define AD9117_REG_SPI_CTL          0x00
#define AD9117_REG_POWER_DOWN       0x01
#define AD9117_REG_DATA_CTL         0x02
#define AD9117_REG_IDAC_GAIN        0x03
#define AD9117_REG_IRSET            0x04
#define AD9117_REG_IRCML            0x05
#define AD9117_REG_QDAC_GAIN        0x06
#define AD9117_REG_QRSET            0x07
#define AD9117_REG_QRCML            0x08
#define AD9117_REG_AUXDACQ          0x09
#define AD9117_REG_AUX_CTLQ         0x0A
#define AD9117_REG_AUXDACI          0x0B
#define AD9117_REG_AUX_CTLI         0x0C
#define AD9117_REG_RREF             0x0D
#define AD9117_REG_CAL_CTL          0x0E
#define AD9117_REG_CAL_MEM          0x0F
#define AD9117_REG_MEM_ADDR         0x10
#define AD9117_REG_MEM_DATA         0x11
#define AD9117_REG_MEM_RW           0x12
#define AD9117_REG_CLK_MODE         0x14
#define AD9117_REG_VERSION          0x1F

// AD9117_REG_SPI_CTL
#define AD9117_REG_SPI_CTL_MSBFIRST 0x00
#define AD9117_REG_SPI_CTL_LSBFIRST 0x40
#define AD9117_REG_SPI_CTL_UNRESET  0x00
#define AD9117_REG_SPI_CTL_RESET    0x20
#define AD9117_REG_SPI_CTL_SH_INST  0x00
#define AD9117_REG_SPI_CTL_LNG_INST 0x10

// AD9117_REG_POWER_DOWN
#define AD9117_REG_POWER_DOWN_LDO_ON        0x00
#define AD9117_REG_POWER_DOWN_LDO_OFF       0x80
#define AD9117_REG_POWER_DOWN_LDO_STAT_ON   0x40
#define AD9117_REG_POWER_DOWN_LDO_STAT_OFF  0x00
#define AD9117_REG_POWER_DOWN_PWR_UP        0x00
#define AD9117_REG_POWER_DOWN_PWR_DOWN      0x20
#define AD9117_REG_POWER_DOWN_QDAC_ON       0x00
#define AD9117_REG_POWER_DOWN_QDAC_OFF      0x10
#define AD9117_REG_POWER_DOWN_IDAC_ON       0x00
#define AD9117_REG_POWER_DOWN_IDAC_OFF      0x08
#define AD9117_REG_POWER_DOWN_QCLK_ON       0x00
#define AD9117_REG_POWER_DOWN_QCLK_OFF      0x04
#define AD9117_REG_POWER_DOWN_ICLK_ON       0x00
#define AD9117_REG_POWER_DOWN_ICLK_OFF      0x02
#define AD9117_REG_POWER_DOWN_INT_REF       0x00
#define AD9117_REG_POWER_DOWN_EXT_REF       0x01

// AD9117_REG_DATA_CTL
#define AD9117_REG_DATA_CTL_UNSIGNED        0x00
#define AD9117_REG_DATA_CTL_TWOS            0x80
#define AD9117_REG_DATA_CTL_QFIRST          0x00
#define AD9117_REG_DATA_CTL_IFIRST          0x20
#define AD9117_REG_DATA_CTL_QRISING         0x00
#define AD9117_REG_DATA_CTL_IRISING         0x10
#define AD9117_REG_DATA_CTL_SIMUL_OFF       0x08
#define AD9117_REG_DATA_CTL_SIMUL_ON        0x00
#define AD9117_REG_DATA_CTL_DCI_OFF         0x00
#define AD9117_REG_DATA_CTL_DCI_ON          0x04
#define AD9117_REG_DATA_CTL_DCO_OFF         0x00
#define AD9117_REG_DATA_CTL_DCO_SINGLE      0x02
#define AD9117_REG_DATA_CTL_DCO_DOUBLE      0x01

// AD9117_REG_IRSET
#define AD9117_REG_IRSET_DISABLE    0x00
#define AD9117_REG_IRSET_ENABLE     0x80

// AD9117_REG_IRCML
#define AD9117_REG_IRCML_DISABLE    0x00
#define AD9117_REG_IRCML_ENABLE     0x80

// AD9117_REG_QRSET
#define AD9117_REG_QRSET_DISABLE    0x00
#define AD9117_REG_QRSET_ENABLE     0x80

// AD9117_REG_QRCML
#define AD9117_REG_QRCML_DISABLE    0x00
#define AD9117_REG_QRCML_ENABLE     0x80

// AD9117_REG_AUX_CTLQ
#define AD9117_REG_AUX_CTLQ_DISABLE     0x00
#define AD9117_REG_AUX_CTLQ_ENABLE      0x80
#define AD9117_REG_AUX_CTLQ_RANGE_2V0   0x00
#define AD9117_REG_AUX_CTLQ_RANGE_1V5   0x20
#define AD9117_REG_AUX_CTLQ_RANGE_1V0   0x40
#define AD9117_REG_AUX_CTLQ_RANGE_0V5   0x60
#define AD9117_REG_AUX_CTLQ_TOP_1V0     0x00
#define AD9117_REG_AUX_CTLQ_TOP_1V5     0x04
#define AD9117_REG_AUX_CTLQ_TOP_2V0     0x08
#define AD9117_REG_AUX_CTLQ_TOP_2V5     0x0C
#define AD9117_REG_AUX_CTLQ_TOP_2V9     0x10
#define AD9117_REG_AUX_CTLQ_TOP_DIRECT  0x1C

// AD9117_REG_AUX_CTLI
#define AD9117_REG_AUX_CTLI_DISABLE     0x00
#define AD9117_REG_AUX_CTLI_ENABLE      0x80
#define AD9117_REG_AUX_CTLI_RANGE_2V0   0x00
#define AD9117_REG_AUX_CTLI_RANGE_1V5   0x20
#define AD9117_REG_AUX_CTLI_RANGE_1V0   0x40
#define AD9117_REG_AUX_CTLI_RANGE_0V5   0x60
#define AD9117_REG_AUX_CTLI_TOP_1V0     0x00
#define AD9117_REG_AUX_CTLI_TOP_1V5     0x04
#define AD9117_REG_AUX_CTLI_TOP_2V0     0x08
#define AD9117_REG_AUX_CTLI_TOP_2V5     0x0C
#define AD9117_REG_AUX_CTLI_TOP_2V9     0x10
#define AD9117_REG_AUX_CTLI_TOP_DIRECT  0x1C

// AD9117_REG_CAL_CTL
#define AD9117_REG_CAL_CTL_PRELOADQ         0x80
#define AD9117_REG_CAL_CTL_PRELOADI         0x40
#define AD9117_REG_CAL_CTL_CALQ             0x20
#define AD9117_REG_CAL_CTL_CALI             0x10
#define AD9117_REG_CAL_CTL_CAL_CLK_DISABLE  0x00
#define AD9117_REG_CAL_CTL_CAL_CLK_ENABLE   0x08
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV256   0x00
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV128   0x01
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV64    0x02
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV32    0x03
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV16    0x04
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV8     0x05
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV4     0x06
#define AD9117_REG_CAL_CTL_CAL_CLK_DIV2     0x07

// AD9117_REG_CAL_MEM
#define AD9117_REG_CAL_MEM_CALSTATQ_DONE    0x80
#define AD9117_REG_CAL_MEM_CALSTATI_DONE    0x40
#define AD9117_REG_CAL_MEM_CALMEMQ_UNCAL    0x00
#define AD9117_REG_CAL_MEM_CALMEMQ_SELF     0x04
#define AD9117_REG_CAL_MEM_CALMEMQ_USER     0x08
#define AD9117_REG_CAL_MEM_CALMEMI_UNCAL    0x00
#define AD9117_REG_CAL_MEM_CALMEMI_SELF     0x01
#define AD9117_REG_CAL_MEM_CALMEMI_USER     0x02

// AD9117_REG_MEM_RW
#define AD9117_REG_MEM_RW_CALRSTQ           0x80
#define AD9117_REG_MEM_RW_CALRSTI           0x40
#define AD9117_REG_MEM_RW_CAL_START         0x10
#define AD9117_REG_MEM_RW_SMEMWR            0x08
#define AD9117_REG_MEM_RW_SMEMRD            0x04
#define AD9117_REG_MEM_RW_UNCALQ            0x02
#define AD9117_REG_MEM_RW_UNCALI            0x01

// AD9117_REG_CLK_MODE
#define AD9117_REG_CLK_MODE_MODEQ_PHASE2    0x00
#define AD9117_REG_CLK_MODE_MODEQ_PHASE3    0x40
#define AD9117_REG_CLK_MODE_MODEQ_PHASE3_1  0x80
#define AD9117_REG_CLK_MODE_MODEQ_PHASE1    0xC0
#define AD9117_REG_CLK_MODE_SEARCHING       0x10
#define AD9117_REG_CLK_MODE_REACQUIRE       0x08
#define AD9117_REG_CLK_MODE_CLKMODE_FORCED  0x04
#define AD9117_REG_CLK_MODE_MODEI_PHASE2    0x00
#define AD9117_REG_CLK_MODE_MODEI_PHASE3    0x01
#define AD9117_REG_CLK_MODE_MODEI_PHASE3_1  0x02
#define AD9117_REG_CLK_MODE_MODEI_PHASE1    0x03


uint8_t ad9117_init();

void ad9117_config_reset();

void ad9117_calibrate(uint32_t ulCLKINFrequency);

void ad9117_i_gain_set_value(uint8_t ubGain);
uint8_t ad9117_i_gain_get_value();
void ad9117_i_offset_config(uint8_t ubEnable, uint8_t ubRange);
void ad9117_i_offset_set_value(uint16_t usOffset);
uint16_t ad9117_i_offset_get_value();

void ad9117_q_gain_set_value(uint8_t ubGain);
uint8_t ad9117_q_gain_get_value();
void ad9117_q_offset_config(uint8_t ubEnable, uint8_t ubRange);
void ad9117_q_offset_set_value(uint16_t usOffset);
uint16_t ad9117_q_offset_get_value();


#endif // __AD9117_H__